#!/bin/bash
# Show VCL content for a Fastly service
# Usage: fastly-vcl-show --service-id SERVICE_ID --version VERSION [--name VCL_NAME] [--profile PROFILE]

set -euo pipefail

# Default values
PROFILE="${FASTLY_PROFILE:-user}"
SERVICE_ID=""
VERSION=""
VCL_NAME=""

# Parse arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
        --service-id)
            SERVICE_ID="$2"
            shift 2
            ;;
        --version)
            VERSION="$2"
            shift 2
            ;;
        --name)
            VCL_NAME="$2"
            shift 2
            ;;
        --profile)
            PROFILE="$2"
            shift 2
            ;;
        --help)
            echo "Usage: fastly-vcl-show --service-id SERVICE_ID --version VERSION [--name VCL_NAME] [--profile PROFILE]"
            echo ""
            echo "Show VCL content for a Fastly service version"
            echo ""
            echo "Options:"
            echo "  --service-id ID      Fastly service ID (required)"
            echo "  --version VERSION    Service version (required)"
            echo "  --name NAME          VCL name (optional, shows first if not specified)"
            echo "  --profile PROFILE    Fastly profile to use (default: user)"
            echo ""
            echo "Examples:"
            echo "  fastly-vcl-show --service-id abc123xyz --version 42"
            echo "  fastly-vcl-show --service-id abc123xyz --version 42 --name main"
            exit 0
            ;;
        *)
            echo "Unknown option: $1" >&2
            echo "Use --help for usage information" >&2
            exit 1
            ;;
    esac
done

# Validate required arguments
if [[ -z "$SERVICE_ID" ]]; then
    echo "Error: --service-id is required" >&2
    echo "Use --help for usage information" >&2
    exit 1
fi

if [[ -z "$VERSION" ]]; then
    echo "Error: --version is required" >&2
    echo "Use --help for usage information" >&2
    exit 1
fi

# Execute Fastly CLI
if [[ -n "$VCL_NAME" ]]; then
    fastly vcl describe --service-id="$SERVICE_ID" --version="$VERSION" --name="$VCL_NAME" --profile="$PROFILE"
else
    fastly vcl describe --service-id="$SERVICE_ID" --version="$VERSION" --profile="$PROFILE"
fi
